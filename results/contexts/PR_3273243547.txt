
Context for PR #3273243547
Primary language: Rust

PR title:
fix(tool-stub): use URL hash as version for HTTP backend with "latest"

PR body:
When tool stubs use the HTTP backend with version "latest" (the default),
generate a stable version string based on the URL hash. This prevents
repeated installations of the same tool when the URL hasn't changed.

The version format becomes "url-{8-char-hash}" instead of "latest",
ensuring consistent caching behavior and avoiding reinstallation on
every run.

ðŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


Diff summary:
src/cli/tool_stub.rs
@@ -1,6 +1,7 @@
 use std::collections::BTreeMap;
 use std::path::{Path, PathBuf};
 
+use crate::backend::static_helpers::lookup_platform_key;
 use crate::config::Config;
 use crate::dirs;
 use crate::
...
         self.version.clone()
+            }
+        } else {
+            self.version.clone()
+        };
+
+        ToolRequest::new_opts(backend_arg.into(), &version, options, source)
     }
 }
 

First failing CI snippet:


Top review comments:
## Pull Request Overview

This fix addresses an issue where HTTP-backed tool stubs with "latest" versions were being repeatedly installed due to unstable version strings. The change generates a stable version string based on the URL hash for HTTP backends using "latest" versions.

- Modifies the `to_tool_request` method to generate hash-based versions for HTTP backends
- Adds URL hash generation logic to create stable version identifiers
- Imports the `lookup_platform_key` helper function for platform-specific URL lookups




---
## Hyperfine Performance
### `mise x -- echo`
| Command | Mean [ms] | Min [ms] | Max [ms] | Relative |
|:---|---:|---:|---:|---:|
| `mise-2025.7.30 x -- echo` | 18.1 Â± 0.5 | 17.7 | 26.2 | 1.00 |
| `mise x -- echo` | 18.4 Â± 0.3 | 17.8 | 21.1 | 1.01 Â± 0.03 |
### `mise env`
| Command | Mean [ms] | Min [ms] | Max [ms] | Relative |
|:---|---:|---:|---:|---:|
| `mise-2025.7.30 env` | 17.6 Â± 0.4 | 17.0 | 22.7 | 1.00 |
| `mise env` | 17.7 Â± 0.3 | 17.2 | 19.7 | 1.01 Â± 0.03 |
### `mise hook-env`
| Command | Mean [ms] | Min [ms] | Max [ms] | Relative |
|:---|---:|---:|---:|---:|
| `mise-2025.7.30 hook-env` | 17.3 Â± 0.2 | 16.8 | 18.6 | 1.00 |
| `mise hook-env` | 17.5 Â± 0.4 | 17.0 | 21.0 | 1.01 Â± 0.03 |
### `mise ls`
| Command | Mean [ms] | Min [ms] | Max [ms] | Relative |
|:---|---:|---:|---:|---:|
| `mise-2025.7.30 ls` | 15.8 Â± 0.5 | 15.3 | 21.7 | 1.00 |
| `mise ls` | 16.1 Â± 0.2 | 15.6 | 17.0 | 1.02 Â± 0.03 |
## `xtasks/test/perf`
| Command    | mise-2025.7.30 | mise | Variance |
|------------|-----------|------|----------|
| install (cached) |    187ms | âœ…    129ms | +44% |
| ls (cached) |     80ms |     81ms | -1% |
| bin-paths (cached) |     64ms |     65ms | -1% |
| task-ls (cached) |    491ms |    493ms | +0% |

âœ…  Performance improvement: install cached is 44%

<!-- thollander/actions-comment-pull-request "hyperfine" -->

Commit messages (for context):
fix(tool-stub): use URL hash as version for HTTP backend with "latest"

When tool stubs use the HTTP backend with version "latest" (the default),
generate a stable version string based on the URL hash. This prevents
repeated installations of the same tool when the URL hasn't changed.

The version format becomes "url-{8-char-hash}" instead of "latest",
ensuring consistent caching behavior and avoiding reinstallation on
every run.

ðŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
