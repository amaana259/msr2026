
Context for PR #3271748860
Primary language: Rust

PR title:
fix: handle PUT/UPDATE operations when gateway has no peer connections

PR body:
## Description

When a gateway has no connections to other peers, it was failing with `EmptyRing` error. This PR fixes the issue by handling contract operations locally when no peers are available.

## Problem

The production gateway was unable to handle River chat operations when other gateways were down, causing PUT and UPDATE operations to fail with:
- PUT: `EmptyRing` error when trying to find a target peer
- UPDATE: Similar routing failures

## Solution

1. **PUT Operation**: Check if any p
...
solated test gateway - all River operations work
- âœ… Deployed and tested on production gateway - River chat now works when gateway has no peer connections
- âœ… Existing tests pass
- âœ… No regression when peers are available

## Related Issues

This complements PR #1726 which prevents gateways from connecting to themselves. Together, these fixes ensure gateways can operate correctly in isolation.

ðŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>

Diff summary:
crates/core/src/operations/put.rs

crates/core/src/operations/update.rs

crates/core/src/operations/get.rs

crates/core/src/operations/update.rs

tests/test-delegate-integration/Cargo.lock

crates/core/src/operations/update.rs

crates/core/src/operations/put.rs

crates/core/src/node/mod.rs

crates/core/src/operations/get.rs


First failing CI snippet:


Top review comments:
This seems to be only an issue if you are initiating the operation from the gateway itself no?

Otherwise, you are always connected to at least one other peer (the gateway itself) so you would never get EmptyRing.  We shouldn't allow regular peers to perfom operations locally if they are disconnected from the network either afaik.

Gateways are not supposed to be initating gets/puts on their own afaik? I mean the change is harmless  otherwise but unnecessary. 

Or am I missing something?
---
I'll merge, just trying to fix another problem.
---
so this change seems like a proper fix, we should get this in
---
again, if you are not connected to anybody, why would you be able to do updates at all?
---
This changes look legit, I forgot we now distinguish between upstream/downstream.
---
> Together, these fixes ensure gateways can operate correctly in isolation.

Right, but why should gateways operate in isolation (doings get, puts and updates).
---
> > Together, these fixes ensure g
...
 
> Right, but why should gateways operate in isolation (doings get, puts and updates).

It's more that it works in the extreme case - like when it's just starting up. 
---
> This seems to be only an issue if you are initiating the operation from the gateway itself no?
> 
> Otherwise, you are always connected to at least one other peer (the gateway itself) so you would never get EmptyRing. We shouldn't allow regular peers to perfom operations locally if they are disconnected from the network either afaik.
> 
> Gateways are not supposed to be initating gets/puts on their own afaik? I mean the change is harmless otherwise but unnecessary.
> 
> Or am I missing something?

Yeah, it was more out of an abundance of caution in weird situations where the network was just starting up.
---
Still not sure what this PR really fixes (except the update checking for upstream and downstream connections), you should never be initiating ops from the gw since that's not a normal usage pattern.

Commit messages (for context):
fix: handle PUT/UPDATE operations when gateway has no peer connections

When a gateway has no connections to other peers, it should handle
contract operations locally instead of failing with EmptyRing error.

Changes:
- PUT: Check if any peers available before creating SeekNode. If none,
  store contract locally immediately.
- UPDATE: When no peers available, target self for the update operation
  instead of failing.

This fixes River chat functionality on isolated gateways (e.g., production
gat
...
ot found in store" error that was occurring
when River tried to create new room contracts on production gateway.

ðŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
Merge branch 'main' into fix-no-peers-handling
fix: change GET local storage found logs from info to debug

These are routine operational messages that shouldn't be at info level.

ðŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
